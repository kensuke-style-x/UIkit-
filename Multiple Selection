import UIKit

class ViewController: UIViewController,UICollectionViewDelegate,UICollectionViewDataSource,UICollectionViewDelegateFlowLayout{
    
    
    var images: [UIImage?] = [
        UIImage(named: "911_1"),
        UIImage(named: "911_2"),
        UIImage(named: "911_2"),
        UIImage(named: "911_2"),
        UIImage(named: "911_2"),
        UIImage(named: "911_2"),
        UIImage(named: "911_2")
    ]

    
    @IBOutlet weak var collectionView: UICollectionView!
    
    
    //trash box
    @IBOutlet weak var deleteItems: UIBarButtonItem!
    //delete Action
    @IBAction func deleteAction(_ sender: UIBarButtonItem) {
        
        guard let selectedIndexPath = collectionView.indexPathsForSelectedItems, !selectedIndexPath.isEmpty else {return}
        
        
        let sortedIndexPath = selectedIndexPath.sorted(){
            $0.item > $1.item
        }
//            let items = selectedCell.map{$0.item}.sorted().reversed()
            
            for indexPath in sortedIndexPath {
                images.remove(at: indexPath.item)
            }
            
        collectionView.performBatchUpdates({
            
            collectionView.deleteItems(at: sortedIndexPath)
        })
           
        
    }
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        //collectionView delegate
        collectionView.delegate = self
        collectionView.dataSource = self
        
        collectionView.register(CollectionViewCell.nib(), forCellWithReuseIdentifier: "CollectionViewCell")
        
        //Layout
        let layout = UICollectionViewFlowLayout()
        layout.scrollDirection = .vertical
        layout.itemSize = CGSize(width: view.frame.size.width/3.2,
                                 height: view.frame.size.width/3.2)
        layout.sectionInset = UIEdgeInsets(top: 0, left: 0, bottom: 0, right: 0)
        collectionView.collectionViewLayout = layout
        view.addSubview(collectionView)
        
        
        //edit

        navigationItem.leftBarButtonItem = editButtonItem
        
        
        //multiple selection
        collectionView.allowsMultipleSelection = true
        
    }
    
    override func viewDidLayoutSubviews() {
        super.viewDidLayoutSubviews()
        collectionView.frame = view.bounds
    }
    
    override func setEditing(_ editing: Bool, animated: Bool) {
        
        super.setEditing(editing, animated: animated)
        
        collectionView.allowsSelection = editing
        
        collectionView.allowsMultipleSelection = editing
        
        collectionView.reloadData()
    }
   


//collectionView delegate
    
    func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -> Int {
        return images.count
    }
    
    
    
    func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -> UICollectionViewCell {
        
        let cell = collectionView.dequeueReusableCell(withReuseIdentifier: "CollectionViewCell", for: indexPath) as! CollectionViewCell
        
        cell.configure(with: images[indexPath.item]!)
        
        cell.isEditingMode = isEditing //edit
        
        return cell
    }
    
    
    // Re-Order Method
//    func collectionView(_ collectionView: UICollectionView, canMoveItemAt indexPath: IndexPath) -> Bool {
//        return true
//    }
//    
//    func collectionView(_ collectionView: UICollectionView, moveItemAt sourceIndexPath: IndexPath, to destinationIndexPath: IndexPath) {
//        let item = images.remove(at: sourceIndexPath.row)
//        images.insert(item, at: destinationIndexPath.row)
//    }
//    
//  
    

    //Highlight
    func collectionView(_ collectionView: UICollectionView, didHighlightItemAt indexPath: IndexPath) {
        
        if isEditing{
            if let cell = collectionView.cellForItem(at: indexPath) {
            cell.contentView.backgroundColor = #colorLiteral(red: 0.2549019754, green: 0.2745098174, blue: 0.3019607961, alpha: 1)
            }
        }
    }
//
//    func collectionView(_ collectionView: UICollectionView, didUnhighlightItemAt indexPath: IndexPath) {
//        
//        if !isEditing{
//            if let cell = collectionView.cellForItem(at: indexPath) {
//            cell.contentView.backgroundColor = nil
//            }
//        }
//    }
    
//    func collectionView(_ collectionView: UICollectionView, didDeselectItemAt indexPath: IndexPath) {
//        if let cell = collectionView.cellForItem(at: indexPath) as? CollectionViewCell {
//            cell.contentView.backgroundColor = nil
//        }
//    }
    
 
    
}


